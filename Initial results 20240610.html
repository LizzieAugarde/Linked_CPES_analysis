<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lizzie Augarde">
<meta name="dcterms.date" content="2024-10-06">

<title>Linked CPES-registry data analysis - sexuality and language status</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="Initial results 20240610_files/libs/clipboard/clipboard.min.js"></script>
<script src="Initial results 20240610_files/libs/quarto-html/quarto.js"></script>
<script src="Initial results 20240610_files/libs/quarto-html/popper.min.js"></script>
<script src="Initial results 20240610_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Initial results 20240610_files/libs/quarto-html/anchor.min.js"></script>
<link href="Initial results 20240610_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Initial results 20240610_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Initial results 20240610_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Initial results 20240610_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Initial results 20240610_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

<script src="Initial results 20240610_files/libs/kePrint-0.0.1/kePrint.js"></script>
<link href="Initial results 20240610_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Linked CPES-registry data analysis - sexuality and language status</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Lizzie Augarde </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 6, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="methodology" class="level2">
<h2 class="anchored" data-anchor-id="methodology">Methodology</h2>
<p>tendfgfphb</p>
</section>
<section id="overall-composition-of-respondents" class="level2">
<h2 class="anchored" data-anchor-id="overall-composition-of-respondents">Overall composition of respondents</h2>
<p>GNDGbcvbf</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-condensed table-sm table-striped small" data-quarto-postprocess="true">
<caption><strong>Number of CPES respondents by survey year</strong></caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Number of respondents</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">2017</td>
<td style="text-align: center;">44,532</td>
</tr>
<tr class="even">
<td style="text-align: center;">2018</td>
<td style="text-align: center;">59,108</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2019</td>
<td style="text-align: center;">55,931</td>
</tr>
<tr class="even">
<td style="text-align: center;">2021</td>
<td style="text-align: center;">48,570</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2022</td>
<td style="text-align: center;">46,363</td>
</tr>
</tbody>
</table>


</div>
<div class="cell-output-display">
<table class="table table-condensed table-sm table-striped small" data-quarto-postprocess="true">
<caption><strong>CPES respondents by sexuality and survey year</strong></caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Sexuality</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Number of respondents</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Percentage of respondents</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="3" style="text-align: center; vertical-align: top !important;">2017</td>
<td style="text-align: left;">Heterosexual</td>
<td style="text-align: center;">41,808</td>
<td style="text-align: center;">93.9%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sexual minority</td>
<td style="text-align: center;">670</td>
<td style="text-align: center;">1.5%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Missing</td>
<td style="text-align: center;">2,054</td>
<td style="text-align: center;">4.6%</td>
</tr>
<tr class="even">
<td rowspan="3" style="text-align: center; vertical-align: top !important;">2018</td>
<td style="text-align: left;">Heterosexual</td>
<td style="text-align: center;">53,506</td>
<td style="text-align: center;">90.5%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sexual minority</td>
<td style="text-align: center;">834</td>
<td style="text-align: center;">1.4%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Missing</td>
<td style="text-align: center;">4,768</td>
<td style="text-align: center;">8.1%</td>
</tr>
<tr class="odd">
<td rowspan="3" style="text-align: center; vertical-align: top !important;">2019</td>
<td style="text-align: left;">Heterosexual</td>
<td style="text-align: center;">50,281</td>
<td style="text-align: center;">89.9%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sexual minority</td>
<td style="text-align: center;">1,803</td>
<td style="text-align: center;">3.2%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Missing</td>
<td style="text-align: center;">3,847</td>
<td style="text-align: center;">6.9%</td>
</tr>
<tr class="even">
<td rowspan="3" style="text-align: center; vertical-align: top !important;">2021</td>
<td style="text-align: left;">Heterosexual</td>
<td style="text-align: center;">44,300</td>
<td style="text-align: center;">91.2%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Sexual minority</td>
<td style="text-align: center;">690</td>
<td style="text-align: center;">1.4%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Missing</td>
<td style="text-align: center;">3,580</td>
<td style="text-align: center;">7.4%</td>
</tr>
<tr class="odd">
<td rowspan="3" style="text-align: center; vertical-align: top !important;">2022</td>
<td style="text-align: left;">Heterosexual</td>
<td style="text-align: center;">42,123</td>
<td style="text-align: center;">90.9%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Sexual minority</td>
<td style="text-align: center;">672</td>
<td style="text-align: center;">1.4%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Missing</td>
<td style="text-align: center;">3,568</td>
<td style="text-align: center;">7.7%</td>
</tr>
</tbody>
</table>


</div>
<div class="cell-output-display">
<table class="table table-condensed table-sm table-striped small" data-quarto-postprocess="true">
<caption><strong>CPES respondents by language status and survey year</strong></caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Language status</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Number of respondents</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Percentage of respondents</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="3" style="text-align: center; vertical-align: top !important;">2017</td>
<td style="text-align: left;">Native English speaker</td>
<td style="text-align: center;">42,592</td>
<td style="text-align: center;">95.6%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Non-native English speaker</td>
<td style="text-align: center;">1,687</td>
<td style="text-align: center;">3.8%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Missing</td>
<td style="text-align: center;">253</td>
<td style="text-align: center;">0.6%</td>
</tr>
<tr class="even">
<td rowspan="3" style="text-align: center; vertical-align: top !important;">2018</td>
<td style="text-align: left;">Native English speaker</td>
<td style="text-align: center;">53,940</td>
<td style="text-align: center;">91.3%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Non-native English speaker</td>
<td style="text-align: center;">2,673</td>
<td style="text-align: center;">4.5%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Missing</td>
<td style="text-align: center;">2,495</td>
<td style="text-align: center;">4.2%</td>
</tr>
<tr class="odd">
<td rowspan="3" style="text-align: center; vertical-align: top !important;">2019</td>
<td style="text-align: left;">Native English speaker</td>
<td style="text-align: center;">50,475</td>
<td style="text-align: center;">90.2%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Non-native English speaker</td>
<td style="text-align: center;">2,599</td>
<td style="text-align: center;">4.6%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Missing</td>
<td style="text-align: center;">2,857</td>
<td style="text-align: center;">5.1%</td>
</tr>
<tr class="even">
<td rowspan="3" style="text-align: center; vertical-align: top !important;">2021</td>
<td style="text-align: left;">Native English speaker</td>
<td style="text-align: center;">43,444</td>
<td style="text-align: center;">89.4%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Non-native English speaker</td>
<td style="text-align: center;">2,365</td>
<td style="text-align: center;">4.9%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Missing</td>
<td style="text-align: center;">2,761</td>
<td style="text-align: center;">5.7%</td>
</tr>
<tr class="odd">
<td rowspan="3" style="text-align: center; vertical-align: top !important;">2022</td>
<td style="text-align: left;">Native English speaker</td>
<td style="text-align: center;">41,587</td>
<td style="text-align: center;">89.7%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Non-native English speaker</td>
<td style="text-align: center;">2,435</td>
<td style="text-align: center;">5.3%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Missing</td>
<td style="text-align: center;">2,341</td>
<td style="text-align: center;">5.0%</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
<section id="routes-to-diagnosis" class="level2">
<h2 class="anchored" data-anchor-id="routes-to-diagnosis">Routes to diagnosis</h2>
<p>There is evidence of large variation in survival between those diagnosed via different routes. Exploring routes to diagnosis supports initiatives to promote earlier diagnosis of cancer and thereby improve survival rates and reduce cancer mortality. Differences in cancer outcomes between people with different sexualities and proficiency in English could be related to differences in how groups are likely to be diagnosed.</p>
<p>Analysis of CPES responses linked to routes to diagnosis information from the NDRS cancer registry shows that most respondents are diagnosed via urgent suspected cancer (USC) referrals (previously known as two-week wait/TWW referrals), followed by other GP referral routes, then screening. This reflects the pattern among all cancer patients shown in national routes to diagnosis data in years prior to 2020.</p>
<p>a higher proportion of respondents who describe their sexuality as gay, lesbian, or other, are diagnosed via emergency presentation, compared to the proportion of those describing themselves as heterosexual.</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-condensed table-sm table-striped small" data-quarto-postprocess="true">
<caption><strong>CPES respondents by route to diagnosis and survey year</strong></caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Route</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Number of respondents</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Percentage of respondents</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td rowspan="8" style="text-align: center; vertical-align: top !important;">2017</td>
<td style="text-align: left;">Emergency presentation</td>
<td style="text-align: center;">3,788</td>
<td style="text-align: center;">8.5%</td>
</tr>
<tr class="even">
<td style="text-align: left;">GP referral</td>
<td style="text-align: center;">9,559</td>
<td style="text-align: center;">21.5%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Inpatient elective</td>
<td style="text-align: center;">647</td>
<td style="text-align: center;">1.5%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Missing</td>
<td style="text-align: center;">1,431</td>
<td style="text-align: center;">3.2%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Other outpatient</td>
<td style="text-align: center;">3,219</td>
<td style="text-align: center;">7.2%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Screening</td>
<td style="text-align: center;">4,607</td>
<td style="text-align: center;">10.3%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Unknown</td>
<td style="text-align: center;">731</td>
<td style="text-align: center;">1.6%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Urgent suspected cancer referral</td>
<td style="text-align: center;">20,550</td>
<td style="text-align: center;">46.1%</td>
</tr>
<tr class="odd">
<td rowspan="8" style="text-align: center; vertical-align: top !important;">2018</td>
<td style="text-align: left;">Emergency presentation</td>
<td style="text-align: center;">4,379</td>
<td style="text-align: center;">8.3%</td>
</tr>
<tr class="even">
<td style="text-align: left;">GP referral</td>
<td style="text-align: center;">10,246</td>
<td style="text-align: center;">19.3%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Inpatient elective</td>
<td style="text-align: center;">1,075</td>
<td style="text-align: center;">2.0%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Missing</td>
<td style="text-align: center;">1,194</td>
<td style="text-align: center;">2.2%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Other outpatient</td>
<td style="text-align: center;">3,853</td>
<td style="text-align: center;">7.3%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Screening</td>
<td style="text-align: center;">5,430</td>
<td style="text-align: center;">10.2%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Unknown</td>
<td style="text-align: center;">1,310</td>
<td style="text-align: center;">2.5%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Urgent suspected cancer referral</td>
<td style="text-align: center;">25,585</td>
<td style="text-align: center;">48.2%</td>
</tr>
<tr class="odd">
<td rowspan="8" style="text-align: center; vertical-align: top !important;">2019</td>
<td style="text-align: left;">Emergency presentation</td>
<td style="text-align: center;">3,886</td>
<td style="text-align: center;">8.2%</td>
</tr>
<tr class="even">
<td style="text-align: left;">GP referral</td>
<td style="text-align: center;">9,038</td>
<td style="text-align: center;">19.0%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Inpatient elective</td>
<td style="text-align: center;">687</td>
<td style="text-align: center;">1.4%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Missing</td>
<td style="text-align: center;">968</td>
<td style="text-align: center;">2.0%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Other outpatient</td>
<td style="text-align: center;">3,579</td>
<td style="text-align: center;">7.5%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Screening</td>
<td style="text-align: center;">5,465</td>
<td style="text-align: center;">11.5%</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Unknown</td>
<td style="text-align: center;">691</td>
<td style="text-align: center;">1.4%</td>
</tr>
<tr class="even">
<td style="text-align: left;">Urgent suspected cancer referral</td>
<td style="text-align: center;">23,362</td>
<td style="text-align: center;">49.0%</td>
</tr>
</tbody>
</table>


</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="Initial-results-20240610_files/figure-html/rtd_sexuality-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="Initial-results-20240610_files/figure-html/rtd_language-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<pre><code>::::{.columns}
::: {.column style="font-size: 50%;"}

*Excluding respondents with unknown stage or an unstageable cancer. Excludes those with missing sexuality.*

:::
::::</code></pre>
</section>
<section id="stage-at-diagnosis" class="level2">
<h2 class="anchored" data-anchor-id="stage-at-diagnosis">Stage at diagnosis</h2>
<p>Route to diagnosis is closely associated with stage at diagnosis, which is a key predictor of cancer mortality. Early stage at diagnosis is a key aim of the NHS Long-Term plan. As with routes to diagnosis, differences in cancer outcomes between people with different sexualities and proficiency in English could be related to how early different groups are likely to have their cancer diagnosed.</p>
<p>Analysis of CPES responses linked to stage at diagnosis information from the NDRS cancer registry indicates that respondents describing their sexuality as gay, lesbian, or other, are less likely to be diagnosed at a later stage (stage 3 or 4) than heterosexual respondents.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Initial-results-20240610_files/figure-html/stage_sexuality-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<pre><code>::::{.columns}
::: {.column style="font-size: 50%;"}

*Excluding respondents with unknown stage or an unstageable cancer. Excludes those with missing sexuality.*

:::
::::</code></pre>
<p>However, when accounting for confounders, including age at diagnosis and tumour type,…….</p>
<p>Analysis of CPES responses linked to stage at diagnosis information from the NDRS cancer registry indicates that respondents describing themselves as non-native English speakers were more likely to be diagnosed at a later stage than native English speaking respondents.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Initial-results-20240610_files/figure-html/stage_language-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<pre><code>::::{.columns} 
::: {.column style="font-size: 50%;"}  

*Excluding respondents with unknown stage or an unstageable cancer. Excludes those with missing language status.*  

::: 
::::</code></pre>
<p>However, when accounting for confounders, including age at diagnosis and tumour type,…….</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>